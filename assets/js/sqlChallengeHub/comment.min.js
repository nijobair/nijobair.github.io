(function(e){"object"==typeof exports&&"object"==typeof module?e(require("./codeMirror")):"function"==typeof define&&define.amd?define(["./codeMirror"],e):e(CodeMirror)})(function(e){"use strict";function n(e){var n=e.search(o);return-1==n?0:n}function t(e,n,t){return/\bstring\b/.test(e.getTokenTypeAt(r(n.line,0)))&&!/^[\'\"\`]/.test(t)}function i(e,n){var t=e.getMode();return!1!==t.useInnerComments&&t.innerMode?e.getModeAt(n):t}var l={},o=/[^\s\u00a0]/,r=e.Pos,a=e.cmpPos;e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",function(e){e||(e=l);for(var n=this,t=1/0,i=this.listSelections(),o=null,a=i.length-1;a>=0;a--){var m=i[a].from(),c=i[a].to();m.line>=t||(c.line>=t&&(c=r(t,0)),t=m.line,null==o?n.uncomment(m,c,e)?o="un":(n.lineComment(m,c,e),o="line"):"un"==o?n.uncomment(m,c,e):n.lineComment(m,c,e))}}),e.defineExtension("lineComment",function(e,a,m){m||(m=l);var c=this,f=i(c,e),g=c.getLine(e.line);if(null!=g&&!t(c,e,g)){var s=m.lineComment||f.lineComment;if(s){var u=Math.min(0!=a.ch||a.line==e.line?a.line+1:a.line,c.lastLine()+1),d=null==m.padding?" ":m.padding,h=m.commentBlankLines||e.line==a.line;c.operation(function(){if(m.indent){for(var t=null,i=e.line;i<u;++i){var l=c.getLine(i),a=-1===l.search(o)?l:l.slice(0,n(l));(null==t||t.length>a.length)&&(t=a)}for(i=e.line;i<u;++i){l=c.getLine(i);var f=t.length;(h||o.test(l))&&(l.slice(0,f)!=t&&(f=n(l)),c.replaceRange(t+s+d,r(i,0),r(i,f)))}}else for(i=e.line;i<u;++i)(h||o.test(c.getLine(i)))&&c.replaceRange(s+d,r(i,0))})}else(m.blockCommentStart||f.blockCommentStart)&&(m.fullLines=!0,c.blockComment(e,a,m))}}),e.defineExtension("blockComment",function(e,n,t){t||(t=l);var m=this,c=i(m,e),f=t.blockCommentStart||c.blockCommentStart,g=t.blockCommentEnd||c.blockCommentEnd;if(f&&g){if(!/\bcomment\b/.test(m.getTokenTypeAt(r(e.line,0)))){var s=Math.min(n.line,m.lastLine());s!=e.line&&0==n.ch&&o.test(m.getLine(s))&&--s;var u=null==t.padding?" ":t.padding;e.line>s||m.operation(function(){if(0!=t.fullLines){var i=o.test(m.getLine(s));m.replaceRange(u+g,r(s)),m.replaceRange(f+u,r(e.line,0));var l=t.blockCommentLead||c.blockCommentLead;if(null!=l)for(var d=e.line+1;d<=s;++d)(d!=s||i)&&m.replaceRange(l+u,r(d,0))}else{var h=0==a(m.getCursor("to"),n),C=!m.somethingSelected();m.replaceRange(g,n),h&&m.setSelection(C?n:m.getCursor("from"),n),m.replaceRange(f,e)}})}}else(t.lineComment||c.lineComment)&&0!=t.fullLines&&m.lineComment(e,n,t)}),e.defineExtension("uncomment",function(e,n,t){t||(t=l);var a,m=this,c=i(m,e),f=Math.min(0!=n.ch||n.line==e.line?n.line:n.line-1,m.lastLine()),g=Math.min(e.line,f),s=t.lineComment||c.lineComment,u=[],d=null==t.padding?" ":t.padding;e:if(s){for(var h=g;h<=f;++h){var C=m.getLine(h),p=C.indexOf(s);if(p>-1&&!/comment/.test(m.getTokenTypeAt(r(h,p+1)))&&(p=-1),-1==p&&o.test(C))break e;if(p>-1&&o.test(C.slice(0,p)))break e;u.push(C)}if(m.operation(function(){for(var e=g;e<=f;++e){var n=u[e-g],t=n.indexOf(s),i=t+s.length;t<0||(n.slice(i,i+d.length)==d&&(i+=d.length),a=!0,m.replaceRange("",r(e,t),r(e,i)))}}),a)return!0}var v=t.blockCommentStart||c.blockCommentStart,b=t.blockCommentEnd||c.blockCommentEnd;if(!v||!b)return!1;var k=t.blockCommentLead||c.blockCommentLead,L=m.getLine(g),x=L.indexOf(v);if(-1==x)return!1;var R=f==g?L:m.getLine(f),M=R.indexOf(b,f==g?x+v.length:0),O=r(g,x+1),T=r(f,M+1);if(-1==M||!/comment/.test(m.getTokenTypeAt(O))||!/comment/.test(m.getTokenTypeAt(T))||m.getRange(O,T,"\n").indexOf(b)>-1)return!1;var S=L.lastIndexOf(v,e.ch),y=-1==S?-1:L.slice(0,e.ch).indexOf(b,S+v.length);if(-1!=S&&-1!=y&&y+b.length!=e.ch)return!1;y=R.indexOf(b,n.ch);var E=R.slice(n.ch).lastIndexOf(v,y-n.ch);return S=-1==y||-1==E?-1:n.ch+E,(-1==y||-1==S||S==n.ch)&&(m.operation(function(){m.replaceRange("",r(f,M-(d&&R.slice(M-d.length,M)==d?d.length:0)),r(f,M+b.length));var e=x+v.length;if(d&&L.slice(e,e+d.length)==d&&(e+=d.length),m.replaceRange("",r(g,x),r(g,e)),k)for(var n=g+1;n<=f;++n){var t=m.getLine(n),i=t.indexOf(k);if(-1!=i&&!o.test(t.slice(0,i))){var l=i+k.length;d&&t.slice(l,l+d.length)==d&&(l+=d.length),m.replaceRange("",r(n,i),r(n,l))}}}),!0)})});