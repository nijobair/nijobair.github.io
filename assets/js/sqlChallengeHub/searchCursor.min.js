(function(t){"object"==typeof exports&&"object"==typeof module?t(require("./codeMirror")):"function"==typeof define&&define.amd?define(["./codeMirror"],t):t(CodeMirror)})(function(t){"use strict";function e(t){var e=t.flags;return null!=e?e:(t.ignoreCase?"i":"")+(t.global?"g":"")+(t.multiline?"m":"")}function n(t,n){for(var r=e(t),i=r,o=0;o<n.length;o++)-1==i.indexOf(n.charAt(o))&&(i+=n.charAt(o));return r==i?t:new RegExp(t.source,i)}function r(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}function i(t,e,r){e=n(e,"g");for(var i=r.line,o=r.ch,h=t.lastLine();i<=h;i++,o=0){e.lastIndex=o;var l=t.getLine(i),c=e.exec(l);if(c)return{from:v(i,c.index),to:v(i,c.index+c[0].length),match:c}}}function o(t,e,o){if(!r(e))return i(t,e,o);e=n(e,"gm");for(var h,l=1,c=o.line,s=t.lastLine();c<=s;){for(var f=0;f<l&&!(c>s);f++){var a=t.getLine(c++);h=null==h?a:h+"\n"+a}l*=2,e.lastIndex=o.ch;var u=e.exec(h);if(u){var g=h.slice(0,u.index).split("\n"),m=u[0].split("\n"),d=o.line+g.length-1,p=g[g.length-1].length;return{from:v(d,p),to:v(d+m.length-1,1==m.length?p+m[0].length:m[m.length-1].length),match:u}}}}function h(t,e,n){for(var r,i=0;i<=t.length;){e.lastIndex=i;var o=e.exec(t);if(!o)break;var h=o.index+o[0].length;if(h>t.length-n)break;(!r||h>r.index+r[0].length)&&(r=o),i=o.index+1}return r}function l(t,e,r){e=n(e,"g");for(var i=r.line,o=r.ch,l=t.firstLine();i>=l;i--,o=-1){var c=t.getLine(i),s=h(c,e,o<0?0:c.length-o);if(s)return{from:v(i,s.index),to:v(i,s.index+s[0].length),match:s}}}function c(t,e,i){if(!r(e))return l(t,e,i);e=n(e,"gm");for(var o,c=1,s=t.getLine(i.line).length-i.ch,f=i.line,a=t.firstLine();f>=a;){for(var u=0;u<c&&f>=a;u++){var g=t.getLine(f--);o=null==o?g:g+"\n"+o}c*=2;var m=h(o,e,s);if(m){var d=o.slice(0,m.index).split("\n"),p=m[0].split("\n"),x=f+d.length,L=d[d.length-1].length;return{from:v(x,L),to:v(x+p.length-1,1==p.length?L+p[0].length:p[p.length-1].length),match:m}}}}function s(t,e,n,r){if(t.length==e.length)return n;for(var i=0,o=n+Math.max(0,t.length-e.length);;){if(i==o)return i;var h=i+o>>1,l=r(t.slice(0,h)).length;if(l==n)return h;l>n?o=h:i=h+1}}function f(t,e,n,r){if(!e.length)return null;var i=r?g:m,o=i(e).split(/\r|\n\r?/);t:for(var h=n.line,l=n.ch,c=t.lastLine()+1-o.length;h<=c;h++,l=0){var f=t.getLine(h).slice(l),a=i(f);if(1==o.length){var u=a.indexOf(o[0]);if(-1==u)continue t;n=s(f,a,u,i)+l;return{from:v(h,s(f,a,u,i)+l),to:v(h,s(f,a,u+o[0].length,i)+l)}}var d=a.length-o[0].length;if(a.slice(d)==o[0]){for(var p=1;p<o.length-1;p++)if(i(t.getLine(h+p))!=o[p])continue t;var x=t.getLine(h+o.length-1),L=i(x),O=o[o.length-1];if(L.slice(0,O.length)==O)return{from:v(h,s(f,a,d,i)+l),to:v(h+o.length-1,s(x,L,O.length,i))}}}}function a(t,e,n,r){if(!e.length)return null;var i=r?g:m,o=i(e).split(/\r|\n\r?/);t:for(var h=n.line,l=n.ch,c=t.firstLine()-1+o.length;h>=c;h--,l=-1){var f=t.getLine(h);l>-1&&(f=f.slice(0,l));var a=i(f);if(1==o.length){var u=a.lastIndexOf(o[0]);if(-1==u)continue t;return{from:v(h,s(f,a,u,i)),to:v(h,s(f,a,u+o[0].length,i))}}var d=o[o.length-1];if(a.slice(0,d.length)==d){var p=1;for(n=h-o.length+1;p<o.length-1;p++)if(i(t.getLine(n+p))!=o[p])continue t;var x=t.getLine(h+1-o.length),L=i(x);if(L.slice(L.length-o[0].length)==o[0])return{from:v(h+1-o.length,s(x,L,x.length-o[0].length,i)),to:v(h,s(f,a,d.length,i))}}}}function u(t,e,r,h){var s;this.atOccurrence=!1,this.afterEmptyMatch=!1,this.doc=t,r=r?t.clipPos(r):v(0,0),this.pos={from:r,to:r},"object"==typeof h?s=h.caseFold:(s=h,h=null),"string"==typeof e?(null==s&&(s=!1),this.matches=function(n,r){return(n?a:f)(t,e,r,s)}):(e=n(e,"gm"),h&&!1===h.multiline?this.matches=function(n,r){return(n?l:i)(t,e,r)}:this.matches=function(n,r){return(n?c:o)(t,e,r)})}var g,m,v=t.Pos;String.prototype.normalize?(g=function(t){return t.normalize("NFD").toLowerCase()},m=function(t){return t.normalize("NFD")}):(g=function(t){return t.toLowerCase()},m=function(t){return t}),u.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){var n=this.doc.clipPos(e?this.pos.from:this.pos.to);if(this.afterEmptyMatch&&this.atOccurrence&&(n=v(n.line,n.ch),e?(n.ch--,n.ch<0&&(n.line--,n.ch=(this.doc.getLine(n.line)||"").length)):(n.ch++,n.ch>(this.doc.getLine(n.line)||"").length&&(n.ch=0,n.line++)),0!=t.cmpPos(n,this.doc.clipPos(n))))return this.atOccurrence=!1;var r=this.matches(e,n);if(this.afterEmptyMatch=r&&0==t.cmpPos(r.from,r.to),r)return this.pos=r,this.atOccurrence=!0,this.pos.match||!0;var i=v(e?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:i,to:i},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e,n){if(this.atOccurrence){var r=t.splitLines(e);this.doc.replaceRange(r,this.pos.from,this.pos.to,n),this.pos.to=v(this.pos.from.line+r.length-1,r[r.length-1].length+(1==r.length?this.pos.from.ch:0))}}},t.defineExtension("getSearchCursor",function(t,e,n){return new u(this.doc,t,e,n)}),t.defineDocExtension("getSearchCursor",function(t,e,n){return new u(this,t,e,n)}),t.defineExtension("selectMatches",function(e,n){for(var r=[],i=this.getSearchCursor(e,this.getCursor("from"),n);i.findNext()&&!(t.cmpPos(i.to(),this.getCursor("to"))>0);)r.push({anchor:i.from(),head:i.to()});r.length&&this.setSelections(r,0)})});