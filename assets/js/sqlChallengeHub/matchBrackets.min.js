(function(t){"object"==typeof exports&&"object"==typeof module?t(require("./codeMirror")):"function"==typeof define&&define.amd?define(["./codeMirror"],t):t(CodeMirror)})(function(t){function e(t){return t&&t.bracketRegex||/[(){}[\]]/}function n(t,n,i){var c=t.getLineHandle(n.line),a=n.ch-1,o=i&&i.afterCursor;null==o&&(o=/(^| )cm-fat-cursor($| )/.test(t.getWrapperElement().className));var s=e(i),f=!o&&a>=0&&s.test(c.text.charAt(a))&&l[c.text.charAt(a)]||s.test(c.text.charAt(a+1))&&l[c.text.charAt(++a)];if(!f)return null;var u=">"==f.charAt(1)?1:-1;if(i&&i.strict&&u>0!=(a==n.ch))return null;var g=t.getTokenTypeAt(h(n.line,a+1)),m=r(t,h(n.line,a+(u>0?1:0)),u,g,i);return null==m?null:{from:h(n.line,a),to:m&&m.pos,match:m&&m.ch==f.charAt(0),forward:u>0}}function r(t,n,r,i,c){for(var a=c&&c.maxScanLineLength||1e4,o=c&&c.maxScanLines||1e3,s=[],f=e(c),u=r>0?Math.min(n.line+o,t.lastLine()+1):Math.max(t.firstLine()-1,n.line-o),g=n.line;g!=u;g+=r){var m=t.getLine(g);if(m){var d=r>0?0:m.length-1,k=r>0?m.length:-1;if(!(m.length>a))for(g==n.line&&(d=n.ch-(r<0?1:0));d!=k;d+=r){var p=m.charAt(d);if(f.test(p)&&(void 0===i||(t.getTokenTypeAt(h(g,d+1))||"")==(i||""))){var v=l[p];if(v&&">"==v.charAt(1)==r>0)s.push(p);else{if(!s.length)return{pos:h(g,d),ch:p};s.pop()}}}}}return g-r!=(r>0?t.lastLine():t.firstLine())&&null}function i(t,e,r){for(var i=t.state.matchBrackets.maxHighlightLineLength||1e3,c=r&&r.highlightNonMatching,a=[],l=t.listSelections(),s=0;s<l.length;s++){var f=l[s].empty()&&n(t,l[s].head,r);if(f&&(f.match||!1!==c)&&t.getLine(f.from.line).length<=i){var u=f.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";a.push(t.markText(f.from,h(f.from.line,f.from.ch+1),{className:u})),f.to&&t.getLine(f.to.line).length<=i&&a.push(t.markText(f.to,h(f.to.line,f.to.ch+1),{className:u}))}}if(a.length){o&&t.state.focused&&t.focus();var g=function(){t.operation(function(){for(var t=0;t<a.length;t++)a[t].clear()})};if(!e)return g;setTimeout(g,800)}}function c(t){t.operation(function(){t.state.matchBrackets.currentlyHighlighted&&(t.state.matchBrackets.currentlyHighlighted(),t.state.matchBrackets.currentlyHighlighted=null),t.state.matchBrackets.currentlyHighlighted=i(t,!1,t.state.matchBrackets)})}function a(t){t.state.matchBrackets&&t.state.matchBrackets.currentlyHighlighted&&(t.state.matchBrackets.currentlyHighlighted(),t.state.matchBrackets.currentlyHighlighted=null)}var o=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),h=t.Pos,l={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};t.defineOption("matchBrackets",!1,function(e,n,r){r&&r!=t.Init&&(e.off("cursorActivity",c),e.off("focus",c),e.off("blur",a),a(e)),n&&(e.state.matchBrackets="object"==typeof n?n:{},e.on("cursorActivity",c),e.on("focus",c),e.on("blur",a))}),t.defineExtension("matchBrackets",function(){i(this,!0)}),t.defineExtension("findMatchingBracket",function(t,e,r){return(r||"boolean"==typeof e)&&(r?(r.strict=e,e=r):e=e?{strict:!0}:null),n(this,t,e)}),t.defineExtension("scanForBracket",function(t,e,n,i){return r(this,t,e,n,i)})});